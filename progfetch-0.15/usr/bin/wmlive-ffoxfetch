#!/bin/sh
#set -x

# Copyright (C) 2015 by Paul Seelig <wmlive@rumbero.org>

# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.

# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.

GXMSG="/usr/bin/gxmessage -center -wrap -name $(basename "${0}")"

notauthorized ()
{
${GXMSG} -buttons "" -title "Sorry, only root can do this" -file - << EOFSORRY

    Installation of third party software requires root permissions
    or explicit membership in the sudo group for authorized users.
EOFSORRY
}

if [ -x /usr/bin/gxmessage ] && [ "$DISPLAY" != "" ]
then
    $GXMSG -buttons "Try Palemoon:3,Get Firefox:2,Cancel:4" -title "Try Palemoon instead" -file - << EOF

    Please note that Firefox has been replaced by Palemoon
    as the standard web browser in Window Maker Live. For this 
    reason, Firefox has not been included with the default 
    installation and needs to be downloaded first.

               Try Palemoon or download Firefox instead?
EOF
    EXITSTATUS="${?}"

    if [ "$EXITSTATUS" = "2" ]
    then
	if [ "$(/usr/bin/id -u)" != "1000" ]
	then
	    notauthorized; exec "${0}"
	else
	    roxterm --title=ffoxfetch --separate --disable-sm --name=progfetch -e sudo /usr/sbin/ffoxfetch
	fi
    elif [ "$EXITSTATUS" = "3" ]
    then
	if [ "$(ps -ef | grep -c "[w]mlive-progfetch")" = "0" ]
	then
	    /opt/palemoon/palemoon >/dev/null 2>&1 &
        elif [ "$(/usr/bin/id -u)" = "1000" ]
	then
	    roxterm --title=pmoonfetch --separate --disable-sm --name=progfetch -e sudo /usr/sbin/pmoonfetch
	elif [ "$(/usr/bin/id -u)" != "0" ]
	then
	    notauthorized; exec "${0}"
	fi
    elif [ "$EXITSTATUS" = "4" ]
    then
        exit 0
    fi
else
    echo "Can't open display, thus quitting ..."
fi
