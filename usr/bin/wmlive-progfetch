#!/bin/sh
#set -x

# Copyright (C) 2015 by Paul Seelig <wmlive@rumbero.org>

# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.

# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.

GXMSG="/usr/bin/gxmessage -center -wrap -name $(basename "${0}")"

notauthorized ()
{
${GXMSG} -buttons "" -title "Sorry, only root can do this" -file - << EOFSORRY

    Installation of third party software requires root permissions
    or explicit membership in the sudo group for authorized users.
EOFSORRY
}

cpufeature ()
{
${GXMSG} -buttons "" -title "Processor does not support SSE2" -file - << EOFSSE2

    This program requires a CPU featuring the SSE2 instruction set, but
    which, unfortunately, is not supported by this system's processor.
EOFSSE2
}

# check CPU for SSE2 instruction set:
CPUFEATURE="$(grep -m 1 ^flags /proc/cpuinfo | grep -ci sse2)" 


if [ "$DISPLAY" != "" ]
then
    $GXMSG -buttons "Firefox:3,Palemoon:5,Telegram:4,Thunderbird:2,FossaMail:6" -title "Get Third Party Programs" -file - << EOF

    The latest versions of Firefox, Palemoon, Telegram, Thunderbird, and 
    FossaMail can be installed or updated directly from their respective
    website as long as your system is connected to the internet. 
EOF
    EXITSTATUS="${?}"

    if [ "$EXITSTATUS" = "2" ]
    then
        if [ "$(/usr/bin/id -u)" != "1000" ]
        then
            notauthorized; exec "${0}"
        else
            roxterm --title=tbrdfetch --separate --disable-sm --name=progfetch -e sudo /usr/sbin/tbrdfetch
        fi && exec "${0}"
    elif [ "$EXITSTATUS" = "3" ]
    then
        /usr/bin/wmlive-ffoxfetch && \
        exec "${0}"
    elif [ "$EXITSTATUS" = "4" ]
    then
        if [ "$(/usr/bin/id -u)" != "1000" ]
        then
            notauthorized; exec "${0}"
        elif [ "${CPUFEATURE}" != "1" ]
        then
            cpufeature; exec "${0}"
        else
            roxterm --title=tlgrmfetch --separate --disable-sm --name=progfetch -e sudo /usr/sbin/tlgrmfetch
        fi && exec "${0}"
    elif [ "$EXITSTATUS" = "5" ]
    then
        if [ "$(/usr/bin/id -u)" != "1000" ]
        then
            notauthorized; exec "${0}"
        elif [ "${CPUFEATURE}" != "1" ]
        then
            cpufeature; exec "${0}"
        else
            roxterm --title=pmoonfetch --separate --disable-sm --name=progfetch -e sudo /usr/sbin/pmoonfetch
        fi && exec "${0}"
    elif [ "$EXITSTATUS" = "6" ]
    then
        if [ "$(/usr/bin/id -u)" != "1000" ]
        then
            notauthorized; exec "${0}"
        elif [ "${CPUFEATURE}" != "1" ]
        then
            cpufeature; exec "${0}"
        else
            roxterm --title=fsmlfetch --separate --disable-sm --name=progfetch -e sudo /usr/sbin/fsmlfetch
        fi && exec "${0}"
    fi
else
    echo "Can't open display, thus quitting ..."
fi
